<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.board.mapper.file.FileMapper">
    <insert id="insFileInfo" parameterType="com.board.dto.file.InsFileInfoDTO" useGeneratedKeys="true" keyProperty="no">
        INSERT INTO file_info (
            origin_name
            , save_name
            , save_path
            , extension
            , size
            , created_at
            , author_no
            , modified_at
            , modifier_no
            , parent_no
            , parent_type
            , status
        ) VALUES (
            #{originName} 
            , #{saveName} 
            , #{savePath} 
            , #{extension}
            , #{size} 
            , UNIX_TIMESTAMP()
            , #{authorNo}
            , NULL
            , NULL
            , #{parentNo}
            , #{parentType}
            , #{status}
        );
    </insert>

    <!-- file_info 상태 업데이트.
        TEMP 파일에서 NORMAL 파일로 -->
    <update id="changeFileStatus">
        UPDATE
            file_info f
        SET
            f.status = 'NORMAL'
            , f.save_path = #{newPath}
            , f.parent_no = #{parentNo}
            , f.parent_type = #{fileInfoParentType}
        WHERE
            f.no = #{fileInfoNo}
    </update>

    <select id="selectFileSaveName">
        SELECT
            f.save_name
        FROM
            file_info f
        WHERE
            f.no = #{fileInfoNo}
    </select>

    <select id="selectFileSavePath">
        SELECT
            f.save_path
        FROM
            file_info f
        WHERE
            f.no = #{fileInfoNo}
    </select>

    <delete id="deleteFileInfo">
        DELETE FROM
            file_info f
        WHERE
            f.no = #{fileInfoNo}

    </delete>
</mapper>